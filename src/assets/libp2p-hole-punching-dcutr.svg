<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1012.5981px" preserveAspectRatio="none" style="width:1289px;height:1012px;" version="1.1" viewBox="0 0 1289 1012" width="1289.5016px" zoomAndPan="magnify"><defs><filter height="300%" id="fjry63u2d9hu5" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="5.42948038176034"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="10.85896076352068" dy="10.85896076352068" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fjry63u2d9hu5)" height="709.438" style="stroke: #000000; stroke-width: 5.42948038176034;" width="1225.7052" x="35.2916" y="150.1166"/><rect fill="#FFFFFF" filter="url(#fjry63u2d9hu5)" height="373.7222" style="stroke: #000000; stroke-width: 5.42948038176034;" width="1171.4104" x="62.439" y="215.631"/><line style="stroke: #A80036; stroke-width: 2.71474019088017; stroke-dasharray: 5.0,5.0;" x1="309.4804" x2="309.4804" y1="103.9661" y2="905.7052"/><line style="stroke: #A80036; stroke-width: 2.71474019088017; stroke-dasharray: 5.0,5.0;" x1="412.6405" x2="412.6405" y1="103.9661" y2="905.7052"/><line style="stroke: #A80036; stroke-width: 2.71474019088017; stroke-dasharray: 5.0,5.0;" x1="1168.6957" x2="1168.6957" y1="103.9661" y2="905.7052"/><rect fill="#FEFECE" filter="url(#fjry63u2d9hu5)" height="82.2481" style="stroke: #A80036; stroke-width: 4.072110286320255;" width="62.439" x="274.1888" y="8.1442"/><text fill="#000000" font-family="sans-serif" font-size="38.0064" lengthAdjust="spacingAndGlyphs" textLength="24.4327" x="293.1919" y="62.4258">A</text><rect fill="#FEFECE" filter="url(#fjry63u2d9hu5)" height="82.2481" style="stroke: #A80036; stroke-width: 4.072110286320255;" width="62.439" x="274.1888" y="902.9905"/><text fill="#000000" font-family="sans-serif" font-size="38.0064" lengthAdjust="spacingAndGlyphs" textLength="24.4327" x="293.1919" y="957.272">A</text><rect fill="#FEFECE" filter="url(#fjry63u2d9hu5)" height="82.2481" style="stroke: #A80036; stroke-width: 4.072110286320255;" width="65.1538" x="374.6341" y="8.1442"/><text fill="#000000" font-family="sans-serif" font-size="38.0064" lengthAdjust="spacingAndGlyphs" textLength="27.1474" x="393.6373" y="62.4258">R</text><rect fill="#FEFECE" filter="url(#fjry63u2d9hu5)" height="82.2481" style="stroke: #A80036; stroke-width: 4.072110286320255;" width="65.1538" x="374.6341" y="902.9905"/><text fill="#000000" font-family="sans-serif" font-size="38.0064" lengthAdjust="spacingAndGlyphs" textLength="27.1474" x="393.6373" y="957.272">R</text><rect fill="#FEFECE" filter="url(#fjry63u2d9hu5)" height="82.2481" style="stroke: #A80036; stroke-width: 4.072110286320255;" width="65.1538" x="1130.6893" y="8.1442"/><text fill="#000000" font-family="sans-serif" font-size="38.0064" lengthAdjust="spacingAndGlyphs" textLength="27.1474" x="1149.6925" y="62.4258">B</text><rect fill="#FEFECE" filter="url(#fjry63u2d9hu5)" height="82.2481" style="stroke: #A80036; stroke-width: 4.072110286320255;" width="65.1538" x="1130.6893" y="902.9905"/><text fill="#000000" font-family="sans-serif" font-size="38.0064" lengthAdjust="spacingAndGlyphs" textLength="27.1474" x="1149.6925" y="957.272">B</text><path d="M35.2916,150.1166 L244.3266,150.1166 L244.3266,169.1198 L217.1792,196.2672 L35.2916,196.2672 L35.2916,150.1166 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 2.71474019088017;"/><rect fill="none" height="709.438" style="stroke: #000000; stroke-width: 5.42948038176034;" width="1225.7052" x="35.2916" y="150.1166"/><text fill="#000000" font-family="sans-serif" font-size="35.2916" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="86.8717" x="76.0127" y="185.5899">loop</text><text fill="#000000" font-family="sans-serif" font-size="29.8621" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="637.9639" x="285.0477" y="183.2648">[Until direct connection established]</text><path d="M62.439,215.631 L640.6787,215.631 L640.6787,234.6341 L613.5313,261.7815 L62.439,261.7815 L62.439,215.631 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 2.71474019088017;"/><rect fill="none" height="373.7222" style="stroke: #000000; stroke-width: 5.42948038176034;" width="1171.4104" x="62.439" y="215.631"/><text fill="#000000" font-family="sans-serif" font-size="35.2916" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="456.0764" x="103.1601" y="251.1042">Via relayed connection</text><polygon fill="#A80036" points="1136.1188,308.6532,1163.2662,319.5122,1136.1188,330.3712,1146.9777,319.5122" style="stroke: #A80036; stroke-width: 2.71474019088017;"/><line style="stroke: #A80036; stroke-width: 2.71474019088017;" x1="310.8378" x2="1152.4072" y1="319.5122" y2="319.5122"/><text fill="#000000" font-family="sans-serif" font-size="35.2916" lengthAdjust="spacingAndGlyphs" textLength="399.0668" x="329.8409" y="305.7595">Connect { addresses }</text><rect fill="#FBFB77" filter="url(#fjry63u2d9hu5)" height="62.439" style="stroke: #A80036; stroke-width: 2.71474019088017;" width="442.5027" x="89.5864" y="354.8038"/><text fill="#000000" font-family="sans-serif" font-size="35.2916" lengthAdjust="spacingAndGlyphs" textLength="420.7847" x="100.4454" y="398.4213">Measure round-trip time</text><polygon fill="#A80036" points="340.6999,477.6882,313.5525,488.5472,340.6999,499.4062,329.8409,488.5472" style="stroke: #A80036; stroke-width: 2.71474019088017;"/><line style="stroke: #A80036; stroke-width: 2.71474019088017;" x1="324.4115" x2="1165.9809" y1="488.5472" y2="488.5472"/><text fill="#000000" font-family="sans-serif" font-size="35.2916" lengthAdjust="spacingAndGlyphs" textLength="399.0668" x="356.9883" y="474.7945">Connect { addresses }</text><polygon fill="#A80036" points="1136.1188,556.7762,1163.2662,567.6352,1136.1188,578.4942,1146.9777,567.6352" style="stroke: #A80036; stroke-width: 2.71474019088017;"/><line style="stroke: #A80036; stroke-width: 2.71474019088017;" x1="310.8378" x2="1152.4072" y1="567.6352" y2="567.6352"/><text fill="#000000" font-family="sans-serif" font-size="35.2916" lengthAdjust="spacingAndGlyphs" textLength="84.1569" x="329.8409" y="553.8826">Sync</text><rect fill="#FBFB77" filter="url(#fjry63u2d9hu5)" height="143.8812" style="stroke: #A80036; stroke-width: 2.71474019088017;" width="917.5822" x="279.6182" y="621.93"/><text fill="#000000" font-family="sans-serif" font-size="35.2916" lengthAdjust="spacingAndGlyphs" textLength="632.5345" x="422.8208" y="665.5475">Simultaneously establish connection</text><text fill="#000000" font-family="sans-serif" font-size="35.2916" lengthAdjust="spacingAndGlyphs" textLength="276.9035" x="422.8208" y="706.6291">- A after 1/2 RTT</text><text fill="#000000" font-family="sans-serif" font-size="35.2916" lengthAdjust="spacingAndGlyphs" textLength="469.6501" x="422.8208" y="747.7108">- B when receiving Connect</text><polygon fill="#A80036" points="340.6999,826.9777,313.5525,837.8367,340.6999,848.6957,329.8409,837.8367" style="stroke: #A80036; stroke-width: 2.71474019088017;"/><polygon fill="#A80036" points="1136.1188,826.9777,1163.2662,837.8367,1136.1188,848.6957,1146.9777,837.8367" style="stroke: #A80036; stroke-width: 2.71474019088017;"/><line style="stroke: #A80036; stroke-width: 2.71474019088017;" x1="324.4115" x2="1152.4072" y1="837.8367" y2="837.8367"/><text fill="#000000" font-family="sans-serif" font-size="35.2916" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="792.7041" x="356.9883" y="824.084">Attempt direct connection / Hole Punch</text><!--MD5=[042e2da0fde3fa0a403d45fe3cf96f6b]
@startuml
scale 1280 width
participant A
participant R
participant B

loop Until direct connection established
group Via relayed connection
A -> B: Connect { addresses }
rnote over A: Measure round-trip time
B -> A: Connect { addresses }
A -> B: Sync
end

rnote over A, B: Simultaneously establish connection\n- A after 1/2 RTT\n- B when receiving Connect
A <-> B: **Attempt direct connection / Hole Punch**
end

@enduml

PlantUML version 1.2020.02(Sun Mar 01 11:22:07 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.13+8-post-Debian-1deb11u1
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>